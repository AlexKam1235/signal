<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SIGNAL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="background-logo"></div>

<main class="panel">

  <section class="block">
    <h2>SIGNAL STATUS</h2>
    <div class="value">STABLE</div>
  </section>

  <section class="block">
    <h2>PHASE</h2>
    <div class="value" id="phase">PENDING</div>
  </section>

  <section class="block">
    <h2>OBSERVERS</h2>
    <div class="value" id="observer-count">ONLINE: 0</div>
    <ul class="observer-log" id="observer-log"></ul>
  </section>

  <section class="block">
    <h2>REWARD POOL</h2>
    <div class="value" id="reward">0 USDT</div>
  </section>

  <div class="action">
    <a href="donate.html">ACKNOWLEDGE SIGNAL</a>
  </div>

  <section class="block proof">
    <h2>FINAL PHASE — INTEGRITY PROOF</h2>
    <div class="small">STATUS: LOCKED</div>
    <code id="hash"></code>
    <div class="hint">Hash published before final phase</div>
  </section>

</main>

<script>
async function loadJSON(path, fallback) {
  try {
    const r = await fetch(path);
    if (!r.ok) throw new Error();
    return await r.json();
  } catch {
    return fallback;
  }
}

async function init() {
  const observers = await loadJSON('observers.json', { observers: [] });
  const reward = await loadJSON('reward.json', { reward_pool: 0 });
  const phase = await loadJSON('phase.json', { phase: "pending" });
  const proof = await loadJSON('proof.json', { final_hash: "—" });

  document.getElementById('phase').textContent = phase.phase.toUpperCase();
  document.body.classList.add("phase-" + phase.phase);

  document.getElementById('reward').textContent =
    reward.reward_pool + " USDT";

  document.getElementById('observer-count').textContent =
    "ONLINE: " + observers.observers.length;

  const list = document.getElementById('observer-log');
  list.innerHTML = "";

  observers.observers.forEach((o, i) => {
    const li = document.createElement('li');
    li.textContent = `[${o.name}] acknowledged`;
    li.className = "observer" + (i === observers.observers.length - 1 ? " new" : "");
    list.appendChild(li);
  });

  document.getElementById('hash').textContent = proof.final_hash;

  const params = new URLSearchParams(location.search);
  if (params.get("ack") === "1") {
    document.body.classList.add("signal-acknowledged");
    setTimeout(() => {
      document.body.classList.remove("signal-acknowledged");
      history.replaceState({}, "", location.pathname);
    }, 6000);
  }
}

init();
</script>

</body>
</html>
